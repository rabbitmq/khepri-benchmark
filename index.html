<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
        integrity="sha512-wnea99uKIC3TJF7v4eKk4Y+lMz2Mklv18+r4na2Gn1abDRPPOeef95xTzdwGD9e6zXJBteMIhZ1+68QC5byJZw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"
          integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"></script>
  <script>
    const workers = [1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200];

    const insert_khepri_safe = [1688, 6694, 9130, 10618, 11001, 14827, 16428, 18352, 21324, 20612, 24393, 25652, 24763, 27525, 30869, 30857, 31015, 33071, 34342, 32744, 28861];
    const insert_khepri_unsafe = [9712, 23882, 31438, 36386, 37828, 40247, 41206, 23208, 43595, 45246, 46080, 45823, 45939, 24165, 48256, 47661, 48577, 48657, 35062, 50096, 49326];
    const insert_mnesia = [20857, 33483, 33250, 35567, 36813, 38582, 39213, 40541, 41041, 42122, 40989, 41441, 42329, 40830, 40872, 38772, 38870, 37117, 40830, 40674, 38843];

    const insert_clustered_khepri_safe = [594, 1770, 2323, 2698, 3021, 2937, 3334, 3461, 3402, 3802, 3904, 4105, 4083, 4184, 4338, 4406, 4265, 4177, 4356, 4698, 4808];
    const insert_clustered_khepri_unsafe = [796, 2088, 2697, 2909, 3216, 3558, 3429, 3411, 3594, 3777, 4231, 3630, 3811, 3604, 3785, 3839, 4041, 4318, 4105, 4191, 4411];
    const insert_clustered_mnesia = [1292, 2747, 3460, 3716, 3848, 3917, 4010, 3948, 4101, 4155, 4064, 4135, 4322, 4379, 4421, 4321, 4396, 4187, 4270, 4183, 4244];

    const delete_khepri_safe = [2391, 9481, 13088, 16378, 19244, 22749, 22120, 23450, 24306, 27338, 25007, 29924, 31931, 42621, 38328, 44480, 44747, 48817, 44239, 51444, 44705];
    const delete_khepri_unsafe = [10240, 29593, 41217, 49351, 46407, 51098, 48157, 53774, 54505, 53798, 55655, 30587, 58746, 62947, 62861, 61550, 34052, 65377, 64374, 65408, 63668];
    const delete_mnesia = [21535, 36894, 37753, 37316, 37658, 40510, 38674, 41192, 41862, 41526, 42389, 41056, 42633, 41318, 42666, 43564, 42300, 42345, 43052, 43069, 42292];

    const delete_clustered_khepri_safe = [558, 1840, 2499, 2970, 3119, 3531, 3906, 3970, 4157, 4424, 4494, 4499, 4623, 4609, 4680, 4899, 5213, 5057, 4961, 5233, 5461];
    const delete_clustered_khepri_unsafe = [774, 2155, 2735, 3361, 3399, 3653, 3959, 3995, 4118, 4261, 4397, 4317, 4329, 4496, 4634, 4998, 4809, 4957, 4838, 4895, 4952];
    const delete_clustered_mnesia = [1250, 2740, 3529, 3728, 3824, 3986, 3947, 3954, 4078, 4189, 4044, 4165, 4492, 4334, 4545, 4455, 4523, 4482, 4382, 4519, 4401];

    const labels = [];
    for (var i in workers) {
      const worker = workers[i];
      labels.push(worker.toString());
    }

    const datasets = [
      {
        label: 'Khepri (safe)',
        borderColor: 'rgb(75, 192, 192)', // green
        fill: false,
        cubicInterpolationMode: 'monotone',
        tension: 0.4
      }, {
        label: 'Khepri (unsafe)',
        borderColor: 'rgb(54, 162, 235)', // blue
        fill: false,
        cubicInterpolationMode: 'monotone',
        tension: 0.4
      }, {
        label: 'Mnesia',
        borderColor: 'rgb(255, 99, 132)', // red
        fill: false,
        cubicInterpolationMode: 'monotone',
        tension: 0.4
      }
    ];

    var insert_datasets = JSON.parse(JSON.stringify(datasets));
    insert_datasets[0].data = insert_khepri_safe;
    insert_datasets[1].data = insert_khepri_unsafe;
    insert_datasets[2].data = insert_mnesia;

    const insert_data = {
      labels: labels,
      datasets: insert_datasets
    };

    var insert_clustered_datasets = JSON.parse(JSON.stringify(datasets));
    insert_clustered_datasets[0].data = insert_clustered_khepri_safe;
    insert_clustered_datasets[1].data = insert_clustered_khepri_unsafe;
    insert_clustered_datasets[2].data = insert_clustered_mnesia;

    const insert_clustered_data = {
      labels: labels,
      datasets: insert_clustered_datasets
    };

    var delete_datasets = JSON.parse(JSON.stringify(datasets));
    delete_datasets[0].data = delete_khepri_safe;
    delete_datasets[1].data = delete_khepri_unsafe;
    delete_datasets[2].data = delete_mnesia;

    const delete_data = {
      labels: labels,
      datasets: delete_datasets
    };

    var delete_clustered_datasets = JSON.parse(JSON.stringify(datasets));
    delete_clustered_datasets[0].data = delete_clustered_khepri_safe;
    delete_clustered_datasets[1].data = delete_clustered_khepri_unsafe;
    delete_clustered_datasets[2].data = delete_clustered_mnesia;

    const delete_clustered_data = {
      labels: labels,
      datasets: delete_clustered_datasets
    };

    const config = {
      type: 'line',
      options: {
        responsive: true,
        plugins: {
          title: {
            display: false,
          },
          legend: {
            labels: {
              //color: 'rgb(209, 213, 219)',
            },
          },
        },
        interaction: {
          intersect: false,
        },
        scales: {
          x: {
            display: true,
            title: {
              display: true,
              text: 'Concurrent workers',
              //color: 'rgb(209, 213, 219)',
            }
          },
          y: {
            display: true,
            title: {
              display: true,
              text: 'Operation per second',
              //color: 'rgb(209, 213, 219)',
            },
            suggestedMin: 0,
          }
        }
      },
    };

    const insert_config = {
      ...config,
      ...{ data: insert_data }
    };

    const insert_clustered_config = {
      ...config,
      ...{ data: insert_clustered_data }
    };

    const delete_config = {
      ...config,
      ...{ data: delete_data }
    };

    const delete_clustered_config = {
      ...config,
      ...{ data: delete_clustered_data }
    };
  </script>
</head>
<body>
  <div class="container mx-auto mt-4">
    <h1 class="text-5xl font-bold text-center mb-16">Khepri benchmark</h1>

    <div class="max-w-max mb-16 mx-auto border border-gray-400 rounded flex py-4">
        <div class="w-16 my-auto mx-4 text-center overflow-hidden flex-none">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 426 426" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 426 426">
                <g>
                <path d="M416,176.619c5.523,0,10-4.477,10-10s-4.477-10-10-10h-49.152v-26.381H416c5.523,0,10-4.477,10-10s-4.477-10-10-10h-49.152   V69.152c0-5.523-4.477-10-10-10h-41.086V10c0-5.523-4.477-10-10-10s-10,4.477-10,10v49.152H269.38V10c0-5.523-4.477-10-10-10   s-10,4.477-10,10v49.152H223V10c0-5.523-4.477-10-10-10s-10,4.477-10,10v49.152h-26.381V10c0-5.523-4.477-10-10-10s-10,4.477-10,10   v49.152h-26.381V10c0-5.523-4.477-10-10-10s-10,4.477-10,10v49.152H69.152c-5.523,0-10,4.477-10,10v41.086H10   c-5.523,0-10,4.477-10,10s4.477,10,10,10h49.152v26.381H10c-5.523,0-10,4.477-10,10s4.477,10,10,10h49.152V203H10   c-5.523,0-10,4.477-10,10s4.477,10,10,10h49.152v26.381H10c-5.523,0-10,4.477-10,10s4.477,10,10,10h49.152v26.381H10   c-5.523,0-10,4.477-10,10s4.477,10,10,10h49.152v41.086c0,5.523,4.477,10,10,10h41.086V416c0,5.523,4.477,10,10,10s10-4.477,10-10   v-49.152h26.381V416c0,5.523,4.477,10,10,10s10-4.477,10-10v-49.152H203V416c0,5.523,4.477,10,10,10s10-4.477,10-10v-49.152h26.38   V416c0,5.523,4.477,10,10,10s10-4.477,10-10v-49.152h26.381V416c0,5.523,4.477,10,10,10s10-4.477,10-10v-49.152h41.086   c5.523,0,10-4.477,10-10v-41.086H416c5.523,0,10-4.477,10-10s-4.477-10-10-10h-49.152v-26.381H416c5.523,0,10-4.477,10-10   s-4.477-10-10-10h-49.152V223H416c5.523,0,10-4.477,10-10s-4.477-10-10-10h-49.152v-26.381H416z M346.848,203h-8.821   c-5.523,0-10,4.477-10,10s4.477,10,10,10h8.821v26.381h-8.821c-5.523,0-10,4.477-10,10s4.477,10,10,10h8.821v26.381h-8.821   c-5.523,0-10,4.477-10,10s4.477,10,10,10h8.821v31.086h-31.086v-8.821c0-5.523-4.477-10-10-10s-10,4.477-10,10v8.821H269.38v-8.821   c0-5.523-4.477-10-10-10s-10,4.477-10,10v8.821H223v-8.821c0-5.523-4.477-10-10-10s-10,4.477-10,10v8.821h-26.381v-8.821   c0-5.523-4.477-10-10-10s-10,4.477-10,10v8.821h-26.381v-8.821c0-5.523-4.477-10-10-10s-10,4.477-10,10v8.821H79.152v-31.086h8.821   c5.523,0,10-4.477,10-10s-4.477-10-10-10h-8.821v-26.381h8.821c5.523,0,10-4.477,10-10s-4.477-10-10-10h-8.821V223h8.821   c5.523,0,10-4.477,10-10s-4.477-10-10-10h-8.821v-26.381h8.821c5.523,0,10-4.477,10-10s-4.477-10-10-10h-8.821v-26.381h8.821   c5.523,0,10-4.477,10-10s-4.477-10-10-10h-8.821V79.152h31.086v8.821c0,5.523,4.477,10,10,10s10-4.477,10-10v-8.821h26.381v8.821   c0,5.523,4.477,10,10,10s10-4.477,10-10v-8.821H203v8.821c0,5.523,4.477,10,10,10s10-4.477,10-10v-8.821h26.38v8.821   c0,5.523,4.477,10,10,10s10-4.477,10-10v-8.821h26.381v8.821c0,5.523,4.477,10,10,10s10-4.477,10-10v-8.821h31.086v31.086h-8.821   c-5.523,0-10,4.477-10,10s4.477,10,10,10h8.821v26.381h-8.821c-5.523,0-10,4.477-10,10s4.477,10,10,10h8.821V203z"/>
                <path d="m266.774,149.225h-107.549c-5.523,0-10,4.477-10,10v107.55c0,5.523 4.477,10 10,10h107.549c5.523,0 10-4.477 10-10v-107.55c0-5.523-4.477-10-10-10zm-10,107.55h-87.549v-87.55h87.549v87.55z"/>
                </g>
            </svg>
        </div>
        <div class="bg-white flex flex-col justify-between leading-normal mr-4">
            <div class="">
                <div class="text-gray-900 font-bold text-xl mb-2">
                    System information
                </div>
                <ul class="text-gray-700 text-base">
                    <li>OS: Linux</li>
                    <li>CPU: Intel(R) Xeon(R) CPU E5-2673 v3 @ 2.40GHz</li>
                    <li>Number of cores: 2</li>
                    <li>Memory: 7 GiB</li>
                    <li>Erlang: 24.2.2</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="flex flex-wrap gap-x-4 gap-y-32">
      <div class="w-5/12 h-96 flex-1">
        <h2 class="text-2xl font-bold text-center mb-6">Inserts (unclustered)</h2>
        <canvas id="insert_chart"></canvas>
        <script>
          const insert_ctx = document.getElementById('insert_chart');
          const insert_chart = new Chart(insert_ctx, insert_config);
        </script>
      </div>
      <div class="w-5/12 h-96 flex-1">
        <h2 class="text-2xl font-bold text-center mb-6">Inserts (3-node cluster)</h2>
        <canvas id="insert_clustered_chart"></canvas>
        <script>
          const insert_clustered_ctx = document.getElementById('insert_clustered_chart');
          const insert_clustered_chart = new Chart(insert_clustered_ctx, insert_clustered_config);
        </script>
      </div>
      <div class="w-5/12 h-96 flex-1">
        <h2 class="text-2xl font-bold text-center mb-6">Deletes (unclustered)</h2>
        <canvas id="delete_chart"></canvas>
        <script>
          const delete_ctx = document.getElementById('delete_chart');
          const delete_chart = new Chart(delete_ctx, delete_config);
        </script>
      </div>
      <div class="w-5/12 h-96 flex-1">
        <h2 class="text-2xl font-bold text-center mb-6">Deletes (3-node cluster)</h2>
        <canvas id="delete_clustered_chart"></canvas>
        <script>
          const delete_clustered_ctx = document.getElementById('delete_clustered_chart');
          const delete_clustered_chart = new Chart(delete_clustered_ctx, delete_clustered_config);
        </script>
      </div>
    </div>
  </div>
</body>
</html>
